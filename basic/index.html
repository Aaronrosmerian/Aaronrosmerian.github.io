<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sistem Laporan Keuangan</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#f1f3f6;
--card:#ffffff;
--text:#222;
--border:#ddd;
--primary:#007bff;
}

body.dark{
--bg:#1e1e1e;
--card:#2a2a2a;
--text:#f1f1f1;
--border:#444;
--primary:#4da3ff;
}

body{
font-family:'Segoe UI',sans-serif;
background:var(--bg);
color:var(--text);
margin:0;
padding:30px;
transition:0.3s;
}

.card{
background:var(--card);
padding:25px;
border-radius:12px;
box-shadow:0 8px 20px rgba(0,0,0,0.08);
margin-bottom:25px;
}

.grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:15px;
}

input,select{
padding:10px;
border-radius:8px;
border:1px solid var(--border);
background:transparent;
color:var(--text);
}

button{
padding:8px 12px;
border:none;
border-radius:8px;
cursor:pointer;
margin-top:8px;
font-weight:500;
}

.btn-primary{background:var(--primary);color:white;}
.btn-success{background:#28a745;color:white;}
.btn-danger{background:#dc3545;color:white;}
.btn-wa{background:#25D366;color:white;}
.btn-mode{background:#555;color:white;}

table{
width:100%;
border-collapse:collapse;
margin-top:15px;
}

th,td{
padding:10px;
text-align:center;
border-bottom:1px solid var(--border);
}

th{
background:var(--primary);
color:white;
}

.chart-container{
max-width:400px;
margin:auto;
}
</style>
</head>

<body>

<div style="display:flex;justify-content:space-between;align-items:center;">
<h1>Sistem Laporan Keuangan</h1>
<button class="btn-mode" onclick="toggleMode()">Dark / Light</button>
</div>

<div class="card">
<h3>Input Data</h3>
<div class="grid">
<input type="date" id="tanggal">
<input type="number" id="service" placeholder="Total Service">
<input type="number" id="penjualan" placeholder="Total Penjualan">
<input type="number" id="tunai" placeholder="Pembayaran Tunai">
<input type="number" id="nontunai" placeholder="Pembayaran Non Tunai">
<input type="number" id="dp" placeholder="Pembayaran DP">
</div>
<button class="btn-success" onclick="simpanData()">Simpan</button>
</div>

<div class="card">
<h3>Filter Data</h3>
<div class="grid">
<input type="date" id="filterAwal">
<input type="date" id="filterAkhir">
<select id="filterBulan">
<option value="">Semua Bulan</option>
<option value="0">Januari</option>
<option value="1">Februari</option>
<option value="2">Maret</option>
<option value="3">April</option>
<option value="4">Mei</option>
<option value="5">Juni</option>
<option value="6">Juli</option>
<option value="7">Agustus</option>
<option value="8">September</option>
<option value="9">Oktober</option>
<option value="10">November</option>
<option value="11">Desember</option>
</select>
<input type="number" id="filterTahun" placeholder="Tahun">
</div>
<button class="btn-primary" onclick="filterData()">Terapkan Filter</button>
<button class="btn-danger" onclick="resetFilter()">Reset</button>
</div>

<div class="card">
<h3>Data Harian</h3>
<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Service</th>
<th>Penjualan</th>
<th>Tunai</th>
<th>Non Tunai</th>
<th>DP</th>
<th>Total</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="tabel"></tbody>
</table>
<br>
<button class="btn-primary" onclick="exportExcel()">Export Excel</button>
</div>

<div class="card">
<h3>Grafik Total</h3>
<div class="chart-container">
<canvas id="chart"></canvas>
</div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("laporan")) || [];
let editIndex=null;
let currentView=data;

if(localStorage.getItem("mode")==="dark"){
document.body.classList.add("dark");
}

function toggleMode(){
document.body.classList.toggle("dark");
localStorage.setItem("mode",
document.body.classList.contains("dark")?"dark":"light");
}

function formatRupiah(angka){
return "Rp " + angka.toLocaleString("id-ID");
}

function formatTanggal(t){
let d=new Date(t);
return String(d.getDate()).padStart(2,'0')+"/"+
String(d.getMonth()+1).padStart(2,'0')+"/"+
d.getFullYear();
}

function simpanData(){
let obj={
tanggal:document.getElementById("tanggal").value,
service:+document.getElementById("service").value||0,
penjualan:+document.getElementById("penjualan").value||0,
tunai:+document.getElementById("tunai").value||0,
nontunai:+document.getElementById("nontunai").value||0,
dp:+document.getElementById("dp").value||0
};

if(editIndex!=null){
data[editIndex]=obj;
editIndex=null;
}else{
data.push(obj);
}

localStorage.setItem("laporan",JSON.stringify(data));
tampilkan(data);
}

function tampilkan(list){
currentView=list;
let tbody=document.getElementById("tabel");
tbody.innerHTML="";
list.forEach((item,i)=>{
let total=item.service+item.penjualan;
tbody.innerHTML+=`
<tr>
<td>${formatTanggal(item.tanggal)}</td>
<td>${formatRupiah(item.service)}</td>
<td>${formatRupiah(item.penjualan)}</td>
<td>${formatRupiah(item.tunai)}</td>
<td>${formatRupiah(item.nontunai)}</td>
<td>${formatRupiah(item.dp)}</td>
<td>${formatRupiah(total)}</td>
<td>
<button onclick="editData(${i})">Edit</button>
<button onclick="hapusData(${i})">Hapus</button>
<button class="btn-wa" onclick="kirimWA(${i})">WA</button>
</td>
</tr>`;
});
buatGrafik(list);
}

function editData(i){
let d=data[i];
document.getElementById("tanggal").value=d.tanggal;
document.getElementById("service").value=d.service;
document.getElementById("penjualan").value=d.penjualan;
document.getElementById("tunai").value=d.tunai;
document.getElementById("nontunai").value=d.nontunai;
document.getElementById("dp").value=d.dp;
editIndex=i;
}

function hapusData(i){
data.splice(i,1);
localStorage.setItem("laporan",JSON.stringify(data));
tampilkan(data);
}

function filterData(){
let awal=document.getElementById("filterAwal").value;
let akhir=document.getElementById("filterAkhir").value;
let bulan=document.getElementById("filterBulan").value;
let tahun=document.getElementById("filterTahun").value;

let hasil=data.filter(d=>{
let date=new Date(d.tanggal);
let cocok=true;

if(awal && d.tanggal<awal) cocok=false;
if(akhir && d.tanggal>akhir) cocok=false;
if(bulan!=="" && date.getMonth()!=bulan) cocok=false;
if(tahun && date.getFullYear()!=tahun) cocok=false;

return cocok;
});

tampilkan(hasil);
}

function resetFilter(){
document.getElementById("filterAwal").value="";
document.getElementById("filterAkhir").value="";
document.getElementById("filterBulan").value="";
document.getElementById("filterTahun").value="";
tampilkan(data);
}

function exportExcel(){
let exportData=currentView.map(item=>{
return{
Tanggal:formatTanggal(item.tanggal),
Service:item.service,
Penjualan:item.penjualan,
Tunai:item.tunai,
Non_Tunai:item.nontunai,
DP:item.dp,
Total:item.service+item.penjualan
};
});

let wb=XLSX.utils.book_new();
let ws=XLSX.utils.json_to_sheet(exportData);
XLSX.utils.book_append_sheet(wb,ws,"Data Harian");
XLSX.writeFile(wb,"Laporan_Harian.xlsx");
}

function kirimWA(i){
let item=currentView[i];
let pesan=
`* Tanggal : ${formatTanggal(item.tanggal)}
* Total pendapatan service : ${item.service?formatRupiah(item.service):"-"}
* Total penjualan : ${item.penjualan?formatRupiah(item.penjualan):"-"}
* Pembayaran Tunai : ${item.tunai?formatRupiah(item.tunai):"-"}
* Pembayaran Non Tunai : ${item.nontunai?formatRupiah(item.nontunai):"-"}
* Pembayaran DP : ${item.dp?formatRupiah(item.dp):"-"}`;

let nomor="6282257288859";
let url="https://wa.me/"+nomor+"?text="+encodeURIComponent(pesan);
window.open(url,"_blank");
}

let chart;
function buatGrafik(list){
let totalService=0,totalPenjualan=0;
list.forEach(d=>{
totalService+=d.service;
totalPenjualan+=d.penjualan;
});

if(chart) chart.destroy();

chart=new Chart(document.getElementById("chart"),{
type:"doughnut",
data:{
labels:["Service","Penjualan"],
datasets:[{
data:[totalService,totalPenjualan]
}]
}
});
}

tampilkan(data);
</script>

</body>
</html>

